<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz Page</title>
    <style>
        .quiz-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    background-color: #f9f9f9;
}

.option {
    display: block;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
    width: 100%;
    text-align: left;
    background-color: white;
}

.option:hover {
    background-color: #e9e9e9;
}

.result {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 4px;
}

.correct {
    background-color: #d4edda;
    color: #155724;
}

.incorrect {
    background-color: #f8d7da;
    color: #721c24;
}

.button {
    display: inline-block;
    padding: 10px 20px;
    margin-top: 1rem;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.button:hover {
    background-color: #0056b3;
}

#loading {
    text-align: center;
    padding: 20px;
}

.type-selector {
    margin-bottom: 1.5rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.type-button {
    padding: 0.5rem 1rem;
    border: 2px solid #007bff;
    background-color: white;
    color: #007bff;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.type-button:hover {
    background-color: #f8f9fa;
}

.type-button.active {
    background-color: #007bff;
    color: white;
}

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Quiz</h1>
    <p>Help defend the castle by answering questions correctly!</p>

    <div class="quiz-container">
        <div class="type-selector">
            <button class="type-button active" data-type="type1">Type 1</button>
            <button class="type-button" data-type="type2">Type 2</button>
        </div>
        <div id="loading">Loading questions...</div>
        <div id="question"></div>
        <div id="options"></div>
        <div id="result" class="result" style="display: none;"></div>
        <button id="nextQuestion" class="button" style="display: none;">Next Question</button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const socket = io();
        let questions = {
            Debugging: [],
            Git: []
        };
        let currentQuestion = null;
        let currentQuestionType = 'Debugging';

        function getRandomQuestion(type) {
            const typeQuestions = questions[type];  // Get the array for this type
            if (!typeQuestions || typeQuestions.length === 0) return null;
            return typeQuestions[Math.floor(Math.random() * typeQuestions.length)];
        }


        function displayQuestion(question) {
            if (!question) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('loading').textContent = 'No questions available for this type';
                return;
            }

            document.getElementById('loading').style.display = 'none';
            currentQuestion = question;
            
            // Parse markdown and set innerHTML
            const questionElement = document.getElementById('question');
            questionElement.innerHTML = marked.parse(question.question);
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';button.innerHTML = marked.parse(`${option[0]}. ${option[1]}`);
                button.disabled = false;
                button.addEventListener('click', function() {
                    checkAnswer(option);
                });
                optionsContainer.appendChild(button);
            });

            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';
            document.getElementById('nextQuestion').style.display = 'none';

        }

        function switchQuestionType(type) {
            currentQuestionType = type;
            // Update active state of type buttons
            document.querySelectorAll('.type-button').forEach(button => {
                if (button.dataset.type === type) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });

            // Check if we already have questions of this type loaded
            if (questions[type].length === 0) {
                // Load questions for this type
                loadQuestions(type);
            } else {
                displayQuestion(getRandomQuestion(type));
            }
        }

        function checkAnswer(selectedAnswer) {
            const resultDiv = document.getElementById('result');
            const nextButton = document.getElementById('nextQuestion');
            console.log(selectedAnswer[0])
            console.log(currentQuestion.answer)
            
            if (selectedAnswer[0] == currentQuestion.answer) {
            
                resultDiv.textContent = 'Correct!';
                resultDiv.className = 'result correct';
                submitAnswer(true)
            } else {
                
                resultDiv.textContent = `Incorrect. The correct answer is ${currentQuestion.answer}`;
                resultDiv.className = 'result incorrect';
                submitAnswer(false)
            }
            
            resultDiv.style.display = 'block';
            nextButton.style.display = 'block';

            const options = document.getElementsByClassName('option');
            Array.from(options).forEach(option => {
                option.disabled = true;
                option.style.cursor = 'default';
            });
        }

        function submitAnswer(correct) {
            // Emit answer correctness to server
            socket.emit('submit_answer', { correct: correct });
        }

        function loadQuestions(type) {
            document.getElementById('loading').style.display = 'block';
            fetch(`/get-questions/${type}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load questions');
                    }
                    return response.json();
                })
                .then(data => {
                    questions[type] = data;
                    displayQuestion(getRandomQuestion(type));
                })
                .catch(error => {
                    document.getElementById('loading').textContent = 
                        'Error loading questions. Please check if the server is running.';
                    console.error('Error:', error);
                });
        }

        window.onload = () => {
            // Load initial question type
            loadQuestions(currentQuestionType);

            // Add event listener for next question button
            const nextButton = document.getElementById('nextQuestion');
            nextButton.addEventListener('click', function() {
                displayQuestion(getRandomQuestion(currentQuestionType));
            });

            // Add event listeners for type buttons
            document.querySelectorAll('.type-button').forEach(button => {
                button.addEventListener('click', function() {
                    switchQuestionType(this.dataset.type);
                });
            });
        };

    </script>
</body>
</html>
